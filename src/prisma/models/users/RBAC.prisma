model Role {
  id              Int              @id @default(autoincrement())
  tenantId        String           @map("tenant_id") @db.Uuid
  name            String           @db.VarChar(100)
  description     String?          @db.Text

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  
  rolePermissions RolePermission[]
  userRoles       UserRole[]

  @@map("roles")
}

model Permission {
  id              Int              @id @default(autoincrement())
  key             String           @unique @db.VarChar(100)
  description     String?          @db.Text

  rolePermissions RolePermission[]

  @@map("permissions")
}

model RolePermission {
  roleId       Int        @map("role_id")
  permissionId Int        @map("permission_id")

  role         Role       @relation(fields: [roleId], references: [id])
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
  @@map("role_permissions")
}

model UserRole {
  userId  String @map("user_id") @db.Uuid
  roleId  Int    @map("role_id")

  user    User   @relation(fields: [userId], references: [id])
  role    Role   @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
  @@map("user_roles")
}

model Log {
  id         BigInt    @id @default(autoincrement())
  tenantId   String    @map("tenant_id") @db.Uuid
  userId     String?   @map("user_id") @db.Uuid
  action     String    @db.VarChar(150)
  entityType String?   @map("entity_type") @db.VarChar(100)
  entityId   String?   @map("entity_id") @db.Uuid
  ipAddress  String?   @map("ip_address") @db.VarChar(50)
  timestamp  DateTime  @default(now())

  tenant     Tenant    @relation(fields: [tenantId], references: [id])
  user       User?     @relation(fields: [userId], references: [id])

  @@map("logs")
}